## DESAFIOS

### 1. Crea un SP con las siguientes 4 variables y que al utilizar el comando CALL, las mismas puedan ser visualizadas.

```sql
    /*
    Nombre: Cliente. 
    Tipo: Caracteres con 10 posiciones. 
    Valor: Juan.

    Nombre: Edad. 
    Tipo: Entero. 
    Valor: 10.

    Nombre: Fecha_Nacimiento. 
    Tipo: Fecha. 
    Valor: 10/01/2007.

    Nombre: Costo. 
    Tipo: Número con casillas decimales. 
    Valor: 10.23 .
    */

```


### 2. Crea un SP que actualice la edad de los clientes. Recuerda que el comando para calcular la edad, en la tabla tabla_de_clientes es:

```sql

    TIMESTAMPDIFF(YEAR, FECHA_DE_NACIMIENTO, CURDATE()) as EDAD
```

![Edades en BD](/imagenes/desafios/edades_bd.png)


Procedimiento para actualizar las edades a hoy 4 agosto 2024

```sql
    USE `credicel_alura_bd`;
    DROP procedure IF EXISTS `calcula_edad`;

    DELIMITER $$
        USE `credicel_alura_bd`$$
        CREATE PROCEDURE `calcula_edad` ()
        BEGIN
            UPDATE credicel_alura_bd.tabla_de_clientes
                SET EDAD=TIMESTAMPDIFF(YEAR, FECHA_DE_NACIMIENTO, CURDATE());
        END$$

    DELIMITER ;
```

Tome en cuenta que el MySQL por defecto no deja usar update y delete sin un where, es necesario desactivar esta proteccion:

![Desactivar Safe Mode](/imagenes/desafios/desactivar_safe_mode.png)

Resultados:

![Resultados Edad](/imagenes/desafios/resultados_edad.png)


### 3. Crea un SP para reajustar el % de comisión de los vendedores. Incluye como parámetro del SP el %, expresado en valor (Ex: 0,90).

- Nombre del Stored Procedure: reajuste_comision.



### 4. ¿Cuál es el comando para tratar los errores?

```SQL
    DECLARE EXIT HANDLER FOR 1062 -- #ERROR
		BEGIN
			SET mensaje="El id del producto ya existe, error!";
            SELECT mensaje;
        END;
```


### 4. Crea una variable llamada N_FACTURAS y atribuye a ella el número de facturas del día 01/01/2017. Muestra en el output del script el valor de la variable. (Nombra este Stored Procedure como cantidad_facturas).




#### 5. ESTE PUNTO: También, debe exhibir el número de facturas NO SE ESTÁ CUMPLIENDO EN EL CÓDIGO... FALTARÍA UN SELECT AL FINAL PARA MOSTRAR EL NRO...

- Crea un Stored Procedure que, basado en una fecha, calcule el número de facturas. 
- Si aparecen más de 70 facturas exhibimos el mensaje: ‘Muchas facturas’. 
- En otro caso, exhibimos el mensaje ‘Pocas facturas’
- También, debe exhibir el número de facturas. Llamaremos este Stored Procedure como: evaluacion_facturas.
- La fecha empleada para evaluar la cantidad de facturas será un parámetro del Stored Procedure.






#### 6. ¡Desafío! Observa la siguiente consulta:

```sql
    SELECT SUM(B.CANTIDAD * B.PRECIO) AS TOTAL_VENTA 
    FROM 
        facturas A 
    INNER   JOIN items_facturas B
            ON A.NUMERO = B.NUMERO
    WHERE A.FECHA_VENTA = '20170301';Copia el código
    -- Esta consulta devuelve el valor de la facturación en una fecha determinada.
```

- Construye un Stored Procedure llamado comparacion_ventas que compare las ventas en dos fechas distintas (Estas fechas serán los parámetros de la SP). 
- Si la variación porcentual de estas ventas es mayor al 10% la respuesta debe ser ‘Verde’. 
- Si está entre -10% y 10% debe retornar ‘Amarillo’. 
- Si la variación es menor al -10% debe retornar ‘Rojo’.




#### 7. Teniendo en cuenta que la siguiente función añade 1 día a la fecha:

```sql
    SELECT ADDDATE(FECHA_VENTA, INTERVAL 1 DAY);
```

- Crea un Stored Procedure que, a partir del día 01/01/2017, 
- cuente el número de facturas hasta el día 10/01/2017. 
- Debemos mostrar la fecha y el número de facturas día tras día. 
- Llamaremos este SP como: suma_dias_facturas.

Tips:

- Declara variables del tipo DATE: Fecha inicial y fecha final; 
- Haz un loop para probar que la fecha inicial < fecha final; 
- muestra en el output de MySQL la fecha y el número de facturas.
- No olvides convertir las variables en tipo VARCHAR; Suma la fecha en 1 día.



#### 8. Crea un Stored Procedure usando un cursor para hallar el valor total de todos los créditos de todos los clientes. Llamaremos este SP como: limite_creditos.

- Tips:
- Declara dos variables: Una que recibe el límite de crédito del cursor y otra el límite de crédito total; 
- haz un loop en el cursor y ve sumando en la variable límite de crédito total el valor del límite de cada cliente; 
- Exhibe el valor total del límite.



#### 9. Crea un Stored Procedure usando un cursor para hallar el valor total de la facturación para un determinado mes y año.

- Tips:
- Declara tres variables: Una que recibe la cantidad, otra el precio y otra que va a acumular la facturación;
- Haz un loop en el cursor e ve sumando el valor de facturación en cada factura; 
- Exhibe el valor total del límite; 
- Recuerda que la consulta quiere obtener la facturación de un mes y año. 
- El comando a continuación muestra todas las facturas generadas en enero de 2017:

```sql
    SELECT  IFa.CANTIDAD, 
            IFa.PRECIO 
    FROM items_facturas IFa
    INNER JOIN facturas  F ON F.NUMERO = IFa.NUMERO
    WHERE   MONTH(F.FECHA_VENTA) = 1 
            AND YEAR(F.FECHA_VENTA) = 2017;
```

- Llamaremos este Stored Procedure como: campo_adicional.



#### 10. Veja a Stored Procedure abaixo:

```sql
    DELIMITER $$
        CREATE PROCEDURE `sp_numero_facturas` ()
        BEGIN
            DECLARE n_facturas INT;
            SELECT COUNT(*) INTO n_facturas 
            FROM facturas WHERE FECHA_VENTA = '20170101';
            SELECT n_facturas;
        END 
    $$
```

- Transforma este SP en una función donde ingresamos como parámetro la fecha y retornamos el número de facturas. 
- Llamaremos esta función f_numero_facturas. 
- Luego de crear la función, ejecútalo utilizando el comando SELECT.
