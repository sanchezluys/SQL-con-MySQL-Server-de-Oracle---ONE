## Tunning y mecanismos de almacenamiento

- Poner a punto o tunning


1. Esquemas, 
2. indices, 
3. variables internas mysqld
4. Por Hardware

### Hardware

- trabajar con SO de 64 bits
- Configuracion de la RAM, no se recomienda usar mas del 50% de la RAM disponible en el equipo
- Tipo de lectura de disco se recomienda SSD y no HDD o nuevas tecnologias SCSI, SATA o SAS (se recomienda SAS)
- Usar la tecnologia RAID (0,1,5 y 10 son empleados para seguridad de los datos)
  - RAID 0: Divide los datos en dos HD diferentes aunque se oberva 1 solo drive el SO divide los datos en los discos
  - RAID 1: Uno de los HD es una copia del otro (lo que haga un disco automaticamente se reproduce en el otro)
  - RAID 5: Divide los datos en mas de dos HDs solo se ve un solo HD
  - RAID 10: Los HD tienen espejos, 
  - Se recomiendan RAID 1 y 10 aunque gastan mas espacio fisico por la redundacia son mas seguros por su backup disponible

Ejemplo:

En una BD de 1GB no va a consumir mas de 8gb, pero en un ambiente real habran varias conexiones ejecutandose en la BD entonces los 8Gb seran pocos en esa situacion

## Variables de ambiente

- Existen mas 250 variables
- SHOW STATUS: muestra los valores actuales de las variables de ambiente
- Existen 2 tipos GLOBAL y SESSION.
  - GLOBAL: es para todo el entorno mysql
  - SESSION: aplica solamente para la conexion actual o instancia actual
- Estan alojadas en **my.ini** para windows y **my.cnf** para Linux

La documentacion:

https://dev.mysql.com/doc/refman/8.4/en/server-system-variables.html

### Variables mas usadas:

- SHOW GLOBAL STATUS

1. **MAX CONNECTIONS**: por defecto 500, limita las conexiones simultaneas
2. **tmp_table_size**: por defecto es 16 Mb, cada vez que se hace una consulta se crean tablas temporales. Cuando se ocupa completo mysql usa el disco duro para continuar ejecutando las consultas y creando tablas temporales lo que hace que sea mas lento.
3. **created_tmp_disk_tables** muestra cuantas tablas temporales han sido creadas en el disco duro (SHOW GLOBAL STATUS LIKE 'created_tmp_disk_tables')
4. SHOW GLOBAL STATUS LIKE '**created_tmp_tables**' muestra las tablas temporales activas en el servidor
5. Para ver el valor de una variable se usa 

```sql
  -- muestra las tablas temporales creadas en el disco del servidor
  SHOW GLOBAL STATUS LIKE 'created_tmp_disk_tables';

  -- muestra las tablas temporales creadas en la ram del servidor
  SHOW GLOBAL STATUS LIKE '%tmp_tables%';
  SHOW GLOBAL STATUS LIKE 'Created_tmp_tables';

  -- muetra la configuracion actual de las tablas temporales del server 
  SHOW GLOBAL VARIABLES LIKE 'tmp_table_size';

  -- cambia el valor de configuracion de la variable
  SET GLOBAL tmp_table_size=17777216;
```

## Mecanismos de almacenamiento

- Forma de almacenar los datos
- Mysql 8.0 tiene 9 mecanismos
- Engine indica el mecanismo
- Los 3 primeros son los mas usados
- Se aplica en la tabla

### Mecanismos

1. MyISAM: 
   1. no es transacional, 
   2. no esta hecho para que varios usuarios realicen operaciones en la mismas tablas simultaneamente. 
   3. El bloqueo es a nivel de tabla (lectura mas rapida). 
   4. Se recomienda su uso en tablas que no cambian continuamente.
   5. La llave foranea no soporta Full text
   6. Almacena datos de manera compacta (optmiza espacio)
   7. Implementa HASH y BTREE (es una ventaja)
   8. Variable: key_buffer_size: determina el tamaño de cache para almacenar los indices varia de 8 Mb a 4 Gb
   9. Variable: concurrent_insert: comportamiento de insercciones concurrentes dentro de una tabla. 
      1.  0: insercciones simultaneas desactivadas. 
      2.  1: insercciones simultaneas sin intervalo de datos al mismo tiempo. 
      3.  2: insercciones simultaneas con intervalo de datos
   10. Variable: delay_key_write: atraso entre la actualizacion de indices y el momento en que se crea la tabla. Espera a que todos los registros sean insertados para despues actualizar los indices. + consistencia pero - rapidez.
   11. Variable: max_write_lock_count: determina el numero de grabaciones en las tablas que tendran precedencia a las lecturas. Priorizar grabaciones a lecturas en las conexiones
   12. Variable: preload_buffer_size: tamaño del buffer a ser usado antes de cargar los indices de caches de claves de las tablas 32kb. 
   13. Estas variables necesaitan que el DBA entienda el entorno. Se recomienda lo que esta por defecto.
   14. Aplicaciones:
       1.  **myisamchk**: analiza, optimiza y repara tablas myisam.
       2.  **myisampack**: crea tablas myisam compactas que seran usadas solo para lectura. no hace posible las insercciones, hecha para el mejor desempeño para lectura.
       3.  **myisam_ftdump**: exhibe informacion mas completa de los campos de tipo texto
   
2. InnoDB
   1. Se define por defecto en mysql
   2. Es transaccional, acepta varios operaciones simultaneas por tabla
   3. Tiene soporte completo a llaves primarias y foraneas
   4. Su cache buffer esta configurado de forma separada tanto para la base como para el indice.
   5. El bloqueo de tabla es a nivel de linea o registro
   6. Indexacion BTREE
   7. Acepta Backup en vivo o en caliente, no es necesario parar el servicio. No hay bloqueo
   8. Variables:
      1. **innodb_data_file_path**: determina el camino y tamaño maximo del archivo dentro del sistema
      2. **innodb_data_home_dir**: camino comun del directorio de todos los archivos innodb; cuando se especifica graba todo dentro de ese directorio. por defecto /mysqldata
      3. **innodb_file_per_table**: separa el almacenamiento de los datos y sus indices. Por defecto almacena datos e indices de forma compartida.
      4. **innodb_buffer_pool_size**: es una variable de desempeño. determina tamaño de almacenamiento para almacenar indices y datos en cache.
      5. **innodb_flush_log_at_trx_commit**: variable de desempeño.  determina la frecuencia con que el buffer de log-in es habilitado para el disco. Crece con el uso y despues de un lapso es descargado al HD
      6. **innodb_log_file_size**: tamaño en bytes con el cual se crearan los archivos log-in. por defecto 5mb

3. Memory
   1. almacena las tablas en la RAM, no en disco, con metodo innodb
   2. no soporta llaves foraneas
   3. acceso muy rapido a la informacion
   4. los datos necesitan ser reinicializados junto con el servidor.
   5. Bloqueo a nivel de tabla
   6. utiliza indices HASH y por defecto BTREE
   7. Formato de linea de longitud fija. no soporta blob/text
   

