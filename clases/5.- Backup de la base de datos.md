## Backup de la base de datos

- Copia de seguridad
- Se recomienda que sea periodica
- Sirve para recuperar los datos y base de datos 
  
### Tipos de Backup

1. Backup Logico:
   1. Exporta todas las estructuras, tablas, rutinas, se recrea la base de datos
   2. Se puede manipular de forma externa antes de recuperar la información, se puede editar
   3. Es mas lento ya que se ejecuta comando a comando
   
2. Backup Fisico:
   1. Contiene todos los archivos binarios del sistema donde la información esta almacenada, pero sin los respectivos comandos.
   2. Archivo mas compacto
   3. No se puede editar
   4. Si se corrompe no es facil recuperar ya que no se guardan los comandos sino los binarios
   
3. **mysqldump**:
   1. No es necesario bloquear la bd
   2. se ejecuta desde consola o cammand promt. en la carpeta bin del servidor
   3. se coloca usuario, 
   4. contraseña y colocamos el servicio.
   5. Después decimos all databases, por ejemplo nos permite a nosotros indicar que el back-up será completo de todas las bases de datos, 
   6. pero si yo pongo solamente databases, entonces es una base de datos en específico que debo decir.
   7. Después utilizo el símbolo de mayor que y el nombre del archivo en el cual va a ser almacenado este archivo mysqldump que va a ser un script de SQL.
   8. Y si ustedes desean incluir stored procedures y eventos, pueden usar --routines y --events respectivamente.
   9. link: https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html

```dos
   c:> mysqldump -u root -p password --databases jugos_ventas > c:\sql_dba\jugos_ventas_full.sql

   -- respaldo sin una tabla especifica
   c:> mysqldump -u root -p password --databases jugos_ventas --ignore-table jugos_ventas.facturas > c:\sql_dba\jugos_ventas_sin_facturas.sql

```

### Backup con Workbench

- Es mas sencillo
- No se puede programar
- primero de deben bloquear las tablas con **LOCK INSTANCE FOR BACKUP;** no permite que se haga nada en la BD
- Luego se habilita con **UNLOCK INSTANCE;** 


![Backup 1](/imagenes/clase05/b_1.png)


![Backup 2](/imagenes/clase05/b_2.png)
con Export to Self-Contained File


![Backup 3](/imagenes/clase05/b_3.png)

![Backup 4](/imagenes/clase05/b_4.png)


### Backup Fisico


- Forma mas eficaz y rapido
- Es necesario bloquear la bd
- Se debe copiar completo el directorio /DATA
- Tambien es necesario copiar el archivo my.ini
- Si alguno de los archivos binarios en esa carpeta tienen algun error se corre el riesgo de perder la data aunque exista el backup fisico
- Por lo anterior se recomienda que se hagan los 2 tipos de backup, el fisico y el logico.
- 

```sql
   LOCK INSTANCE FOR BACKUP;

   UNLOCK INSTANCE;
```

### Recuperando Backups

#### Con Backup logico:

- Se crea la BD en workbench
- Se usa linea de comandos
- En el directorio BIN del servidor mysql
- Para recuperar se usa menor que **<**
- Es mucho mas rapido que usar workbench


```dos
   bin :> mysql -uroot -p
   --
   mysql:> use jugos_ventas;
   mysql:> exit;
   --
   bin:> mysql -uroot -p < c:\sql_dba\jugos_ventas_full.sql

```


### Con Backup Fisico

- Es imperativo parar el servidor
- Se copia la carpeta DATA y el archivo my.ini
- Se pegan en el directorio de mysql
- Dado que esos archivos y directorio existen el mysql notificará que los va a reemplazar y pedira los permisos de escritura. darlos para que se copien
- Reiniciar el servidor

el comando para recuperar respaldo es **mysql**

- no existe una herramienta específica para recuperar el backup. Tan solo, ejecutamos MySQL y el script con extensión .sql que fue generado por el proceso de backup.